{% import 'templates/macros/atoms.html' as atoms %}
<!DOCTYPE html>
<html lang="it">

<head>
    {% include 'templates/partials/head.html' %}
    {% block extra_head %}{% endblock %}
</head>

<body class="font-sans bg-bg-primary text-text-primary leading-relaxed h-screen w-screen overflow-hidden">
    <!-- Background FX -->
    <div class="fixed inset-0 -z-10 bg-gradient-to-br from-bg-primary via-bg-primary to-slate-900 pointer-events-none">
    </div>

    <div class="presentation w-full h-full relative">
        {% for slide in slides %}
        {% set outer_loop = loop %}
        {% set blueprint = blueprints[slide.type] if slide.type in blueprints else blueprints['hero'] %}
        <!-- Default to hero if unknown -->

        <div class="slide absolute inset-0 w-full h-full p-16 opacity-0 transition-opacity duration-500 ease-in-out {% if loop.first %}opacity-100 z-10 active{% else %}z-0{% endif %}"
            data-slide-index="{{ loop.index0 }}">
            <!-- Blueprint Layout -->
            <div class="{{ blueprint.layout }}">
                {% for slot in blueprint.slots %}
                {% set content = slide[slot.name] %}
                <!-- Skip rendering if content is missing, unless it's a structural slot without data needed? Assuming content required. -->
                {% if content is defined %}
                <div class="slot-container {{ slot.class }} {{ slot.span }}">
                    {% if slot.component == 'markdown' %}
                    {{ atoms.render_markdown(content) }}
                    {% elif slot.component == 'code' %}
                    {{ atoms.render_code(content, slide.language | default('text'), slide.filename) }}
                    {% elif slot.component == 'image' %}
                    {{ atoms.render_image(content, slide.title) }}
                    {% elif slot.component == 'stat' %}
                    {# Stat implies list? Or single value? If list, we loop. #}
                    {% if content is sequence and content is not string %}
                    {% for item in content %}
                    {{ atoms.render_stat(item.value, item.label) }}
                    {% endfor %}
                    {% else %}
                    {{ atoms.render_stat(content.value, content.label) }}
                    {% endif %}
                    {% elif slot.component == 'table' %}
                    {{ atoms.render_table(content, 'table-' ~ outer_loop.index) }}
                    {% elif slot.component == 'chart' %}
                    {{ atoms.render_chart(content, slide.chart_type | default('bar'), slide.labels, slide.dataset_label)
                    }}
                    {% elif slot.component == 'mermaid' %}
                    {{ atoms.render_mermaid(content) }}
                    {% elif slot.component == 'process' %}
                    {{ atoms.render_process(content) }}
                    {% elif slot.component == 'card' %}
                    {# Cards are rendered as a grid #}
                    <div class="grid grid-cols-3 gap-6">
                        {% for card in content %}
                        {{ atoms.render_card(card) }}
                        {% endfor %}
                    </div>
                    {% elif slot.component == 'badges' %}
                    {{ atoms.render_badges(content) }}
                    {% endif %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    {% include 'templates/partials/scripts.html' %}

    <!-- Navigation script could be here or in scripts.html, ensuring standard slide nav works with new structure -->
    <script>
        // Basic slide navigation logic (if not provided by scripts.html)
        // Assuming scripts.html handles .slide.active toggling
    </script>
</body>

</html>